## Policy Agentのインストールとセットアップ

保護対象のアプリケーションが稼働するサーバーにPolicy Agentをインストールして、OpenAMと連携できるようにするには、以下の作業が必要です。

1. インストール要件の確認
2. 事前準備
3. エージェントプロファイルの作成
4. エージェントのインストール
5. 認可ポリシーの作成

まずは、Policy Agentがインストール可能なサーバーであるかを確認します(1)。Policy Agentがインストール可能なサーバーはApache HTTP Server、IIS、Tomcat、JBossなどで、バージョンもインストール要件を満たしている必要があります。インストール要件を満たしていることを確認したら、サーバーの設定等を必要に応じて変更します(2)。次に、OpenAMの管理コンソールでPolicy Agentのプロファイルを作成します(3)。プロファイルは、OpenAMと連携するためには必要なPolicy Agentの情報です。プロファイルを作成したら、エージェントをインストールします(4)。最後に、認可ポリシーを作成します(5)。保護するアプリケーションへのアクセスを一部のユーザーや特定のURLにのみ許可、拒否するためにはこの設定が必要です。

###  Java EEエージェントのインストールとセットアップ

Java EEエージェントには、Tomcatエージェント、JBossエージェント、WebSphereエージェントなどがありますが、インストールとセットアップの基本的な作業はほぼ同じです。ここでは、Tomcatエージェントのインストールとセットアップについてのみ解説します。

**手順. TomcatサーバーにTomcatエージェントをインストールする**

#### 1. 事前準備(インストール要件の確認など)

まずは、保護対象のアプリケーションが稼働するサーバーに、Tomcatエージェントがインストールが可能な環境であるかを確認する必要があります。「OpenAM Java EE Policy Agent Release Notes」の「Before You Install」のセクションを確認します。

https://backstage.forgerock.com/docs/openam-jee-policy-agents/3.5/jee-release-notes/chap-before-you-install

次に、「OpenAM Java EE Policy Agent User's Guide」の「Installing Java EE Agents in Apache Tomcat」の「Before You Install」のセクションを確認します。

https://backstage.forgerock.com/docs/openam-jee-policy-agents/3.5/jee-users-guide/chap-apache-tomcat

#### 2. エージェントプロファイルの作成

新しいJava EEエージェントのプロファイルを作成するには、エージェントの名前とパスワードを作成する必要があります。また、OpenAMと保護するアプリケーションへのURLが必要です:

1. 管理者としてOpenAMコンソールにログインします。
2. OpenAMコンソールの「レルム」メニューで、エージェントプロファイルを管理するレルムを選択します。
3. 「エージェント」のリンクをクリックし、作成するエージェントプロファイルの種類のタブページをクリックし、「エージェント」テーブルの「新規作成」ボタンをクリックします。
4. 「名前」フィールドに、エージェントプロファイルの名前を入力します。
5. 「パスワード」フィールドと「パスワードの再入力」フィールドに、新しいエージェントプロファイルのパスワードを入力します。
6. ローカルまたは集中（デフォルト）をクリックして、どこにエージェントのプロパティを保存するかを決定します。「ローカル」を選択すると、エージェントが実行されているサーバーにプロパティが保存されます。集中管理を選択すると、プロパティはOpenAMサーバーに保存されます。
7. 「Server URL」フィールドに、OpenAMのURLを入力します。たとえば、http://openam.example.com:8080/openam
8. 「エージェントURL」フィールドに、ポリシーエージェントによって保護されているアプリケーションサーバーのプライマリURLを入力します。Java EEポリシーエージェントの場合、URLには、agentappコンテキストが含まれている必要があります。たとえば、http://shop.example.com:28080/agentapp
9. 「作成」をクリックします。エージェントプロファイルを作成したら、新しいプロファイルへのリンクをクリックして設定を調整したり、エクスポートすることができます。

#### 3. エージェントのインストール


#### 4. 認可ポリシーの作成など


###  Webエージェントのインストールとセットアップ

Webエージェントには、Apaheエージェント、IISエージェントがあります。以前は。ここでは、Apaheエージェント、IISエージェントの両方について説明します。

**手順. Apache HTTPサーバーにApacheエージェントをインストールする**

#### 1. 事前準備(インストール要件の確認など)

まずはインストールが可能な環境であるかを確認する必要があります。「OpenAM Web Policy Agent Release Notes Search」の「Before You Install」のセクションを確認します。

#### 2. エージェントプロファイルの作成

新しいWebエージェントのプロファイルを作成するには、エージェントの名前とパスワードを作成する必要があります。また、OpenAMと保護するアプリケーションへのURLが必要です:

1. 管理者としてOpenAMコンソールにログインします。
2. OpenAMコンソールの「レルム」メニューで、エージェントプロファイルを管理するレルムを選択します。
3. 「エージェント」のリンクをクリックし、作成するエージェントプロファイルの種類のタブページをクリックし、「エージェント」テーブルの「新規作成」ボタンをクリックします。
4. 「名前」フィールドに、エージェントプロファイルの名前を入力します。
5. 「パスワード」フィールドと「パスワードの再入力」フィールドに、新しいエージェントプロファイルのパスワードを入力します。
6. ローカルまたは集中（デフォルト）をクリックして、どこにエージェントのプロパティを保存するかを決定します。「ローカル」を選択すると、エージェントが実行されているサーバーにプロパティが保存されます。集中管理を選択すると、プロパティはOpenAMサーバーに保存されます。
7. 「Server URL」フィールドに、OpenAMのURLを入力します。たとえば、http://openam.example.com:8080/openam
8. 「エージェントURL」フィールドに、ポリシーエージェントによって保護されているWebサーバーサーバーのプライマリURLを入力します。
9. 「作成」をクリックします。エージェントプロファイルを作成したら、新しいプロファイルへのリンクをクリックして設定を調整したり、エクスポートすることができます。

#### 3. エージェントのインストール


#### 4. 認可ポリシーの作成など

**手順. IISサーバーにIISエージェントをインストールする**

#### 1. 事前準備(インストール要件の確認など)

まずはインストールが可能な環境であるかを確認する必要があります。

#### 2. エージェントプロファイルの作成

#### 3. エージェントのインストール


#### 4. 認可ポリシーの作成など
