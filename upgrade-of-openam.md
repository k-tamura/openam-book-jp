OpenAMのアップグレードはとても簡単です。
ただし、バージョンの組み合わせによっては、アップグレードがうまくできなかったり、手作業で一部の設定を変更しなければならないこともあります。
アップグレードする前に、対象バージョンのForgeRock公式アップグレードガイドを参照し、追加の手順や制限事項などが無いか確認しておいて下さい。

### アップグレードの概要
アップグレード手順は、以下のようになります。

1. Javaコンテナを停止
2. warファイルを更新し、展開済みのディレクトリを削除
3. Javaコンテナを起動
4. OpenAMにアクセスすると、アップグレード画面が表示されるので、アップグレードを実施  

ただし、アップグレードに失敗したり、アップグレード後の動作に問題がある可能性もあるので、バックアップを取得しておくことをお勧めします。バックアップするのは以下のディレクトリになります。

- `/path/to/container/webapps/openam/`  (openam.warが展開されたディレクトリ)
- `/path/to/openam/`  (OpenAMの設定ディレクトリ)
- `/path/to/.openamcfg/`  (OpenAMの設定ディレクトリへのパスが記載されたファイルを含むディレクトリ)

バックアップの際に、Tomcatのworkディレクトリ以下も削除しておいて下さい。アップグレード前に生成されたクラスファイルなどが原因で、異常な動作する可能性があります。また、カスタマイズしたファイルなどがある場合は、アップグレード後にそれを適宜反映することを忘れないで下さい。

なお、今回アップグレードはGUIで行いましたが、コマンドラインのツールで行うこともできます。詳細については、アップグレードガイドを参照して下さい。

### 冗長構成の場合のアップグレード

冗長構成(サイト構成)のOpenAMサーバーをアップグレードする場合は、全サーバーを停止して、1台ずつアップグレードするのではなく、1台のみでアップグレードを実施し、設定変更をOpenDJのレプリケーションで反映させるようにします。

1. 全サーバーのJavaコンテナを停止
2. 全サーバーのwarファイルを更新し、展開済みのディレクトリを削除
3. 全サーバーのJavaコンテナを起動
4. 1台目のOpenAMサーバーにアクセス
5. アップグレード画面が表示されるので、アップグレードを実施  
 (このときOpenDJのレプリケーションで2台目のOpenAMサーバーに、設定データがレプリケーションされます)
